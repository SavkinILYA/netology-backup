# Домашнее задание к занятию «Базы данных, их типы»

## Задание 1. Выбор СУБД для строительной компании

### 1.1 Бюджетирование, финансовая аналитика и прогнозирование рисков  
**Рекомендация:** реляционная СУБД с полноценным ACID  
**Выбор:** PostgreSQL (или Oracle/MS SQL Server при наличии бюджета)  
**Почему:**  
- Строгие требования к целостности финансовых данных  
- Много JOIN-ов между бюджетами, контрактами, фактическими расходами, рисками  
- Нужны внешние ключи, CHECK-констрейнты, триггеры  
- Классический кейс из лекции про реляционную модель и транзакции

### 1.1.* Хеширование начало сильно тормозить  
- Перейти на алгоритм BLAKE3 (в 10–20 раз быстрее SHA-256)  
- Использовать аппаратное ускорение (Intel QAT, AMD-V инструкции)  
- Кэшировать уже посчитанные хеши в Redis → меньше повторных вычислений

### 1.2 Лендинги + CRM  
**Лендинги** — гибкая схема → MongoDB / DynamoDB или PostgreSQL с JSONB  
**CRM** — чаще всего сейчас тоже PostgreSQL + JSONB + обычные реляционные таблицы  
**Итого:** PostgreSQL полностью закрывает обе задачи

### 1.2.* Можно ли одной СУБД?  
**Да.** PostgreSQL 15+ с JSONB-полями и GIN-индексами — лучшее решение 2025 года:  
- Лиды с лендингов — в JSONB  
- Сделки, клиенты, воронки — обычные таблицы  
- Один кластер, один бэкап, одна команда админов

### 1.3 Корпоративная база знаний и стандартов  
- Вариант 1: Elasticsearch (как учили на занятии про ELK-стек)  
- Вариант 2: тот же PostgreSQL + встроенный полнотекстовый поиск + JSONB  
Проще, дешевле, не нужно держать отдельный кластер

### 1.3.* Можно ли использовать уже существующую СУБД?  
Да, берём тот же PostgreSQL, создаём схему `knowledge_base`, добавляем таблицы `documents`, `versions`, `tags` и включаем поиск — всё готово.

### 1.4 Логистика и маршрутизация  
**Рекомендация:** PostgreSQL + PostGIS + pgRouting (бесплатно и очень мощно)  
Если совсем сложные графы — Neo4j  
Но в 90 % случаев pgRouting хватает за глаза

### 1.4.* Подключить ли закупки к той же базе?  
Обязательно. У закупок и логистов одни и те же справочники (поставщики, склады, материалы). Делаем общие таблицы — никаких дублирующих баз.

### 1.5.* Можно ли всё решить одной СУБД?  
**Да, можно и нужно.**  
PostgreSQL + расширения (JSONB, PostGIS, pgRouting, Citus при больших объёмах) закрывает 95 % задач компании.  
Остальное (логи → Elasticsearch, кэш → Redis, очереди → RabbitMQ) — вспомогательные системы, как и проходили на модуле.

## Задание 2. Транзакции

### 2.1 Пополнение баланса телефона вручную (6 шагов)
1. `BEGIN` — начинаем транзакцию  
2. `SELECT ... FOR UPDATE` — блокируем строку баланса абонента  
3. Списание со счёта платёжного шлюза  
4. Зачисление на баланс телефона  
5. Запись в таблицу истории операций  
6. `COMMIT` (или `ROLLBACK` при любой ошибке)

### 2.1.* Автоплатёж  
- Проверка условия (баланс < порога или настала дата)  
- Всё в фоновом воркере  
- Используем очередь сообщений (RabbitMQ, как на занятии №4)  
- При ошибке → dead-letter queue → retry или уведомление клиенту

## Задание 3. SQL vs NoSQL

### 3.1 Пять преимуществ SQL-баз
1. Полные ACID-гарантии  
2. Сложные аналитические запросы и JOIN-ы из коробки  
3. Внешние ключи и ограничения целостности  
4. Стандартизированный SQL — легко найти специалистов  
5. Многотабличные транзакции (обязательно для финансов)

### 3.1.* Преимущества NoSQL
- Горизонтальная масштабируемость как у NoSQL  
- Полноценные ACID-транзакции и привычный SQL  
- Автоматическое шардирование и геораспределение  
- Совместимость с PostgreSQL/MySQL → лёгкая миграция  
Примеры: CockroachDB, TiDB, YugabyteDB

## Задание 4. Кластер на 1000 машин

**Критерий выбора:** тип нагрузки — аналитическая (OLAP), огромный объём данных и вычислений  
**Лучшая СУБД:** ClickHouse  
**Почему:**  
- Columnar storage + векторизованное выполнение  
- MPP-архитектура (massively parallel processing)  
- Линейная масштабируемость до тысяч нод  
- Нативная репликация и шардирование через ClickHouse Keeper  
- Работает на кластерах 1000+ машин (Яндекс, Cloudflare и др.)
